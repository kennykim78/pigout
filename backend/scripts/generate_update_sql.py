import json

# 음식 목록
foods = ["물","밥","현미밥","사과","바나나","두부","계란","닭가슴살","브로콜리","시금치","양배추","당근","토마토","오이","고구마","감자","우유","요거트","견과류","아몬드","호두","녹차","잡곡밥","김밥","비빔밥","볶음밥","김치볶음밥","호박죽","전복죽","삼계죽","김치찌개","된장찌개","순두부찌개","부대찌개","청국장찌개","삼계탕","갈비탕","설렁탕","육개장","감자탕","곰탕","추어탕","미역국","떡국","콩나물국","삼겹살","불고기","갈비","제육볶음","돼지갈비","닭갈비","찜닭","치킨","닭볶음탕","소고기","한우","육회","라면","냉면","칼국수","잔치국수","비빔국수","떡볶이","순대","튀김","어묵","만두","수제비","김치","깍두기","시금치나물","콩나물","계란찜","계란말이","김치전","파전","해물파전","족발","짜장면","짬뽕","탕수육","마라탕","마라샹궈","깐풍기","유린기","팔보채","양장피","초밥","회","돈가스","우동","라멘","소바","카츠동","규동","오니기리","피자","햄버거","파스타","스테이크","샐러드","샌드위치","감자튀김","리조또","그라탕","너겟","빵","케이크","쿠키","아이스크림","과자","초콜릿","커피","콜라","주스"]

# 카테고리별 규칙
rules = {
    "찌개_국": {
        "items": ["김치찌개","된장찌개","순두부찌개","부대찌개","청국장찌개","삼계탕","갈비탕","설렁탕","육개장","감자탕","곰탕","추어탕","미역국","떡국","콩나물국","마라탕","짬뽕","우동","라멘"],
        "warnings": ["높은 나트륨 함량 주의", "고혈압 환자는 국물 섭취 제한 필요", "위염/역류성 식도염 환자 주의 (매운 경우)"],
        "tips": ["국물보다는 건더기 위주로 섭취하세요", "조리 시 소금 대신 천연 조미료를 사용해보세요", "칼륨이 풍부한 채소를 곁들이면 나트륨 배출에 도움이 됩니다"]
    },
    "면": {
        "items": ["라면","냉면","칼국수","잔치국수","비빔국수","짜장면","파스타","소바"],
        "warnings": ["정제 탄수화물 과다 섭취 주의", "급격한 혈당 상승 위험", "소화 불량 가능성"],
        "tips": ["면치기보다는 꼭꼭 씹어 드세요", "채소나 단백질(계란, 고기)을 곁들여 영양 균형을 맞추세요", "면 삶은 물을 버리고 조리하면 지방/나트륨을 줄일 수 있습니다"]
    },
    "고기_튀김": {
        "items": ["삼겹살","갈비","돼지갈비","치킨","돈가스","탕수육","깐풍기","유린기","튀김","감자튀김","너겟","고구마","감자"],
        "warnings": ["포화지방 및 콜레스테롤 주의", "고칼로리로 인한 체중 증가 위험", "탄 부분 섭취 시 발암 물질 위험"],
        "tips": ["튀김보다는 구이나 찜 조리법을 선택하세요", "쌈채소를 듬뿍 곁들여 드세요", "기름진 부위보다는 살코기 위주로 섭취하세요"]
    },
    "분식_간식": {
        "items": ["떡볶이","순대","어묵","만두","김밥","피자","햄버거","빵","케이크","쿠키","아이스크림","과자","초콜릿","콜라","주스"],
        "warnings": ["높은 당류 및 나트륨 함량 주의", "트랜스지방 함유 가능성", "영양 불균형 주의"],
        "tips": ["식사 대용보다는 간식으로 소량만 드세요", "탄산음료 대신 물이나 탄산수를 곁들이세요", "직접 만들어 드시면 당과 나트륨을 조절할 수 있습니다"]
    },
    "밥_죽": {
        "items": ["밥","현미밥","잡곡밥","비빔밥","볶음밥","김치볶음밥","호박죽","전복죽","삼계죽","초밥","오니기리","리조또","그라탕","카츠동","규동"],
        "warnings": ["탄수화물 위주 식사 주의", "당뇨 환자는 섭취량 조절 필요"],
        "tips": ["현미나 잡곡을 섞어 드시면 혈당 조절에 도움이 됩니다", "채소 반찬을 먼저 드시고 밥을 드세요", "천천히 꼭꼭 씹어 드시면 포만감이 빨리 옵니다"]
    },
    "채소_건강": {
        "items": ["사과","바나나","브로콜리","시금치","양배추","당근","토마토","오이","두부","계란","닭가슴살","견과류","아몬드","호두","녹차","샐러드","시금치나물","콩나물","물"],
        "warnings": ["특정 질환(신장 등) 환자는 칼륨/단백질 섭취 주의", "알레르기 주의 (견과류, 계란 등)"],
        "tips": ["신선한 상태로 섭취하는 것이 가장 좋습니다", "드레싱이나 소스는 적게 뿌려 드세요", "균형 잡힌 식단의 일부로 활용하세요"]
    }
}

# 개별 특화 데이터 (덮어쓰기용)
special_data = {
    "물": {
        "warnings": ["신장 질환자는 수분 섭취량 조절 필요", "식사 직전/직후 과도한 섭취는 소화액 희석"],
        "tips": ["하루 8잔(약 2L)을 조금씩 나누어 마시세요", "기상 직후 미지근한 물 한 잔은 건강에 좋습니다"]
    },
    "커피": {
        "warnings": ["카페인 과다 섭취 시 불면증/두근거림", "위염 환자 공복 섭취 주의"],
        "tips": ["하루 2잔 이내로 섭취하세요", "오후 늦은 시간에는 디카페인을 권장합니다"]
    },
    "김치": {
        "warnings": ["높은 나트륨 함량 주의", "위장 질환자 자극 주의"],
        "tips": ["익은 김치는 유산균이 풍부합니다", "물에 씻어 드시면 나트륨과 매운맛을 줄일 수 있습니다"]
    }
}

sql_statements = []

for food in foods:
    warnings = []
    tips = []
    
    # 카테고리 매칭
    matched = False
    for category, rule in rules.items():
        if food in rule["items"]:
            warnings = rule["warnings"]
            tips = rule["tips"]
            matched = True
            break
    
    # 매칭 안 된 경우 기본값
    if not matched:
        warnings = ["과도한 섭취 주의", "알레르기 성분 확인 필요"]
        tips = ["적당량을 골고루 섭취하세요", "신선한 재료를 사용하세요"]

    # 특화 데이터 적용
    if food in special_data:
        warnings = special_data[food]["warnings"]
        tips = special_data[food]["tips"]

    # SQL 생성
    warnings_str = ", ".join([f"'{w}'" for w in warnings])
    tips_str = ", ".join([f"'{t}'" for t in tips])
    
    sql = f"UPDATE food_rules SET warnings = ARRAY[{warnings_str}], cooking_tips = ARRAY[{tips_str}] WHERE food_name = '{food}';"
    sql_statements.append(sql)

# 파일 저장
with open('backend/migrations/20251217_update_food_rules_data.sql', 'w', encoding='utf-8') as f:
    f.write("-- ========================================\n")
    f.write("-- food_rules 데이터 일괄 업데이트 (warnings, cooking_tips)\n")
    f.write("-- Generated by VS Code Assistant\n")
    f.write("-- ========================================\n\n")
    for stmt in sql_statements:
        f.write(stmt + "\n")

print(f"Generated {len(sql_statements)} SQL statements.")
